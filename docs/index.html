<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>MetCon Artist</title>
    <!-- The `react-native-web` recommended style reset: https://necolas.github.io/react-native-web/docs/setup/#root-element -->
    <style id="expo-reset">
      /* These styles make the body full-height */
      html,
      body {
        height: 100%;
      }
      /* These styles disable body scrolling if you are using <ScrollView> */
      body {
        overflow: hidden;
      }
      /* Enable scrolling for mobile web browsers */
      @media (max-width: 768px) {
        body {
          overflow: auto;
        }
      }
      /* These styles make the root element full-height */
      #root {
        display: flex;
        height: 100%;
        flex: 1;
      }
    </style>
  <!-- Cache Control Meta Tags -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#282A36" />
  <meta name="description" content="Generate CrossFit workouts with different modalities and time domains" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="MetCon Artist" />
  <link rel="apple-touch-icon" href="./assets/icon.png?v=4" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="MetCon Artist" />
  <meta name="msapplication-TileColor" content="#282A36" />
  <meta name="msapplication-TileImage" content="./assets/icon.png?v=4" />
  <meta name="msapplication-config" content="none" />
  <!-- Favicon with cache busting -->
  <link rel="icon" type="image/x-icon" href="./favicon.ico?v=2" />
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon.ico?v=2" />
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon.ico?v=2" />
  </head>

  <body>
  <!-- Unregister any old service workers to prevent caching issues -->
  <!-- This must run BEFORE the main script loads to prevent service worker from intercepting -->
  <!-- Mobile browsers cache more aggressively, so we need comprehensive clearing -->
  <script>
    (function() {
      // Clear all caches first (more aggressive for mobile)
      if ('caches' in window) {
        caches.keys().then(function(cacheNames) {
          return Promise.all(
            cacheNames.map(function(cacheName) {
              console.log('Deleting cache:', cacheName);
              return caches.delete(cacheName);
            })
          );
        }).catch(function(error) {
          console.error('Error clearing caches:', error);
        });
      }
      
      // Unregister all service workers immediately
      if ('serviceWorker' in navigator) {
        // Method 1: Get all registrations and unregister
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          console.log('Found', registrations.length, 'service worker(s) to unregister');
          for(let registration of registrations) {
            registration.unregister().then(function(success) {
              if (success) {
                console.log('Unregistered old service worker:', registration.scope);
              } else {
                console.warn('Failed to unregister service worker:', registration.scope);
              }
            }).catch(function(error) {
              console.error('Error unregistering service worker:', error);
            });
          }
        }).catch(function(error) {
          console.error('Error getting service worker registrations:', error);
        });
        
        // Method 2: Also try to unregister by current scope (mobile fallback)
        navigator.serviceWorker.getRegistration().then(function(registration) {
          if (registration) {
            registration.unregister().then(function(success) {
              if (success) {
                console.log('Unregistered service worker by current scope:', registration.scope);
              }
            }).catch(function(error) {
              console.error('Error unregistering service worker by scope:', error);
            });
          }
        });
        
        // Method 3: Try to unregister by all possible scopes (for mobile browsers)
        var scopes = ['./', '/', '/metcon-artist/', '/metcon-artist'];
        scopes.forEach(function(scope) {
          navigator.serviceWorker.getRegistration(scope).then(function(registration) {
            if (registration) {
              registration.unregister().then(function(success) {
                if (success) {
                  console.log('Unregistered service worker for scope:', scope);
                }
              });
            }
          });
        });
      }
    })();
  </script>
<!-- Use static rendering with Expo Router to support running without JavaScript. -->
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <!-- The root element for your Expo app. -->
    <div id="root"></div>
  <script src="./_expo/static/js/web/index-9fa9b692313c9bc13e7af1cbda5f8342.js?v=4" defer></script>
</body>
</html>
